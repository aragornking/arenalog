$(document).ready(function () {
    var json_data = null;
    var json_string = '{"map": 6, "version": "1.2.5", "teams": {"1": {"rating": 1237, "diff": -6, "name": "peerhwnkfc", "mmr": 1437}, "0": {"rating": 1478, "diff": 11, "name": "Olympus has fallen", "mmr": 1451}}, "server": "Neptulon", "elapsed": 109, "bracket": 3, "result": 0, "startTime": "05/08/13 02:24:58", "endTime": "", "data": ["0,13,0,1459,1,3600", "0,13,0,60118,1,0", "0,13,0,6673,1,300", "0,13,0,1126,1,3600", "0,13,1,79640,1,7200.077", "0,13,1,32727,1,0", "0,13,1,1459,1,3600", "0,13,1,6673,1,300", "0,13,1,1126,1,3600", "0,13,1,110482,1,3600", "0.01,14,1,32727,1", "0.01,13,2,6673,1,300", "0.01,13,2,97341,1,0", "0.01,13,2,1126,1,3600", "0.01,13,2,110309,1,3600", "0.54,8,2,0,19316,0", "0.54,13,0,774,1,11.128", "0.54,13,3,57330,1,300", "0.54,13,3,46628,1,0", "0.54,13,3,55610,1,0", "0.54,13,3,48263,1,0", "0.54,13,4,60424,1,0", "0.54,13,4,113742,1,0", "0.54,13,4,57330,1,300", "1.47,9,2,2,8936,1420,0", "1.84,10,1,-1,11426,0", "1.84,13,1,11426,1,60", "3.12,8,2,0,19316,0", "3.71,10,1,-1,66,0", "3.71,13,1,66,1,3", "4.16,9,2,2,8936,1420,1.419", "5.57,17,2,94", "5.57,10,2,0,8936,0", "5.57,13,2,100977,1,20", "5.61,10,2,0,774,0", "5.71,13,1,32612,1,20", "5.71,14,1,66,1", "5.89,8,2,0,19316,0", "5.92,13,2,768,1,0", "5.97,10,2,-1,5215,0", "5.97,17,2,100", "5.97,7,2,0,97094,0", "5.97,8,2,0,19316,0", "5.97,13,2,5215,1,0", "6.56,10,3,0,49576,0", "6.56,14,3,46628,1", "6.75,13,0,48504,1,15", "6.75,13,3,131547,1,3", "7.58,3,0,3,7179,0", "7.58,13,0,52437,1,2", "7.58,14,0,60118,1", "7.79,10,3,0,49576,0", "7.79,14,3,131547,1", "8.02,10,0,3,12294,0", "8.02,10,0,-1,114207,0", "8.33,9,1,3,112948,1420,1.419", "8.33,14,1,32612,1", "8.37,1,3,454112", "8.37,2,3,461291", "8.37,13,0,120032,1,12", "8.48,10,3,0,45524,0", "8.63,3,3,0,7668,0", "8.67,8,2,0,19316,0", "8.77,13,0,96294,2,3", "8.77,13,0,50435,2,8", "8.77,13,0,81326,2,30", "8.77,13,0,55095,2,30", "8.77,13,0,114206,1,0", "8.77,13,1,114206,1,0", "8.79,13,0,45524,2,8", "8.79,14,0,48504,1", "9.17,10,3,-1,51271,0", "9.17,10,3,-1,126679,0", "9.17,1,0,383847", "9.17,2,0,391515", "9.17,13,3,126679,1,20", "9.17,13,3,51271,1,20", "9.17,13,0,29842,1,10", "9.47,10,3,-1,108200,0", "9.47,13,3,108200,1,8", "9.55,10,0,-1,118038,0", "9.55,13,0,118038,1,8", "9.58,7,2,0,20390,0", "9.58,14,0,52437,1", "9.76,10,1,3,112948,0", "9.91,10,1,-1,126683,0", "9.91,10,1,-1,12472,0", "9.91,13,1,12472,1,20", "9.91,13,1,126683,1,20", "9.98,1,0,391515", "9.98,13,3,112948,2,3.787", "10.09,9,1,3,116,1578,1.183", "10.5,10,3,0,49020,0", "10.64,10,0,3,86346,0", "10.78,4,0,3,12621,0", "10.78,13,0,115000,2,3", "10.78,13,3,86346,2,6.5", "10.78,13,3,81326,2,30", "11.19,1,3,441491", "11.26,13,1,44544,1,15", "11.46,8,2,0,13521,0", "11.47,10,0,-1,1719,0", "11.47,10,0,-1,126679,0", "11.47,10,0,-1,107574,0", "11.47,13,0,107574,1,24", "11.47,13,0,126679,1,20", "11.47,13,0,1719,1,12", "11.47,14,0,45524,2", "11.47,14,0,50435,2", "11.47,14,0,96294,2", "11.47,14,0,115000,2", "11.59,13,3,33395,2,8", "11.59,13,0,115000,2,3", "11.66,10,1,3,116,0", "11.77,5,3,0,1758,0", "11.78,10,3,0,49020,0", "11.98,3,0,3,32140,1", "12,1,0,389757", "12,13,3,61258,1,5", "12.19,10,0,-1,118000,0", "12.4,1,3,409351", "12.4,4,0,3,109751,1", "12.4,14,3,33395,2", "12.51,17,1,87", "12.51,10,1,-1,84714,0", "12.63,4,1,3,76092,1", "12.63,13,3,116,2,5.6", "12.67,14,2,5215,1", "12.8,1,3,223508", "12.8,10,2,0,88423,0", "12.8,14,0,115000,2", "12.8,13,1,126705,1,20", "12.8,13,1,104993,1,12", "12.85,3,3,0,6833,0", "13.61,1,0,382924", "13.61,13,0,115000,2,3", "13.61,13,2,114206,1,0", "13.77,13,1,57761,1,15", "13.79,14,3,112948,2", "14,4,1,3,35677,0", "14,4,1,3,21809,1", "14,13,3,84721,2,1.4", "14,13,3,113092,2,1.4", "14.07,10,0,3,12294,0", "14.07,13,0,12294,1,10", "14.07,13,0,126665,1,15", "14.16,10,1,3,30455,0", "14.24,9,2,2,8936,1183,1.183", "14.24,1,3,166022", "14.24,17,2,95", "14.24,8,2,0,14874,0", "14.24,14,2,768,1", "14.41,1,0,391515", "14.41,4,0,3,24219,0", "14.41,13,3,115804,2,10", "14.41,13,3,115767,2,15", "14.54,10,3,-1,48707,0", "14.54,13,3,48707,1,5", "14.77,5,3,0,1759,0", "14.81,1,3,141803", "14.81,1,0,389756", "14.81,13,0,126700,1,20", "14.81,13,0,60503,1,12", "14.81,14,3,84721,2", "15.13,7,3,3,121089,0", "15.13,10,3,-1,48743,0", "15.21,1,3,262892", "15.38,3,0,3,13488,0", "15.38,13,0,52437,1,2", "15.41,9,1,3,44614,2169,1.183", "15.41,10,1,3,44614,0", "15.41,14,3,113092,2", "15.41,14,1,57761,1", "15.6,10,0,3,86346,0", "15.62,4,0,3,27062,0", "15.64,17,2,90", "15.64,10,2,0,8936,0", "15.87,10,2,0,774,0", "16.02,1,3,222342", "16.02,17,1,94", "16.02,7,2,0,75761,0", "16.02,8,2,0,14874,0", "16.13,4,1,3,35187,1", "16.13,14,3,48707,1", "16.42,1,0,391515", "16.42,1,3,187155", "16.63,10,1,3,30455,0", "16.82,4,1,3,8836,0", "16.82,13,0,48504,1,15", "16.82,14,1,44544,1", "16.82,13,3,84721,2,1.4", "17.02,8,2,0,14874,0", "17.1,4,1,3,74105,1", "17.1,10,3,1,47476,0", "17.16,10,0,3,1464,0", "17.23,1,3,104214", "17.23,4,0,3,76342,1", "17.23,13,1,47476,2,5", "17.23,13,1,125487,1,15", "17.37,14,0,52437,1", "17.41,5,0,3,12419,0", "17.48,14,3,108200,1", "17.56,14,0,118038,1", "17.63,1,3,15453", "17.63,13,0,115001,2,6", "17.77,5,3,0,4396,1", "17.77,14,0,48504,1", "18.02,1,3,5823", "18.02,1,0,387119", "18.02,14,3,126679,1", "18.02,14,3,51271,1", "18.02,14,3,57330,1", "18.02,14,3,61258,1", "18.02,14,3,115804,2", "18.02,14,3,81326,2", "18.02,14,3,86346,2", "18.02,14,3,115767,2", "18.02,14,3,116,2", "18.02,14,3,84721,2", "18.39,4,0,3,7530,0", "18.44,1,3,0", "18.44,7,2,0,17500,0", "18.44,13,0,32216,1,20", "18.44,14,0,114206,1", "18.44,14,1,114206,1", "18.44,14,2,114206,1", "18.83,1,0,391515", "19.28,17,1,100", "19.8,8,2,0,14873,0", "20.37,14,0,120032,1", "20.64,14,0,115000,2", "20.78,5,3,0,2198,0", "20.84,1,0,389317", "22.23,14,1,47476,2", "22.58,8,2,0,30640,0", "22.85,1,0,391515", "23.48,14,0,1719,1", "23.63,14,0,115001,2", "23.78,5,3,0,4395,1", "24.06,1,0,387120", "24.06,14,0,12294,1", "24.81,14,1,104993,1", "24.86,1,0,391058", "25.36,8,2,0,13521,0", "25.64,10,2,0,88423,0", "25.67,1,0,391515", "26.46,10,0,4,100,0", "26.47,13,4,7922,2,1.5", "26.78,5,3,0,2198,0", "26.81,14,0,60503,1", "26.87,1,0,389317", "27.22,9,1,4,112948,1183,1.183", "27.87,10,0,4,12294,0", "27.87,13,0,12294,1,10", "27.97,3,0,4,16600,0", "27.98,14,4,7922,2", "28.08,4,0,4,55879,1", "28.08,13,4,115804,2,10", "28.08,13,4,115767,2,15", "28.16,8,2,0,14874,0", "28.16,14,0,774,1", "28.41,10,1,4,112948,0", "28.49,1,4,345448", "28.49,2,4,417927", "28.49,1,0,391515", "28.49,13,0,12880,1,6", "28.49,13,0,60503,1,12", "28.49,13,0,120032,1,12.002", "28.49,13,4,112948,2,3.155", "28.65,9,1,4,116,1578,1.183", "28.97,10,2,1,774,0", "29.17,14,0,29842,1", "29.29,8,2,1,13522,0", "29.29,13,1,774,1,11.128", "29.58,10,0,4,7384,0", "29.69,4,0,4,37874,1", "29.69,13,4,34936,1,8", "29.77,5,3,0,2198,0", "29.93,14,1,126683,1", "29.93,14,1,12472,1", "30.1,1,4,307574", "30.1,1,0,389317", "30.23,10,1,4,116,0", "30.23,9,1,4,116,1893,1.183", "30.76,10,0,4,7384,0", "30.76,14,0,60503,1", "30.9,4,0,4,41487,1", "31.09,5,0,4,13809,0", "31.31,1,4,252278", "31.31,13,0,52437,1,2", "31.37,3,0,4,20829,0", "31.47,14,0,126679,1", "31.64,4,1,4,26828,0", "31.64,13,1,57761,1,15", "31.64,13,4,116,2,8", "31.64,14,4,112948,2", "31.71,1,4,225450", "31.71,4,0,4,8808,0", "31.71,4,1,4,33584,0", "31.71,13,4,113092,2,2", "32.07,8,2,1,27854,0", "32.07,10,0,4,86346,0", "32.11,1,4,162229", "32.11,4,0,4,34617,0", "32.11,13,4,86346,2,6.5", "32.11,13,4,81326,2,30", "32.13,17,1,95", "32.13,10,1,4,116,0", "32.13,9,1,4,116,1893,1.419", "32.23,14,1,125487,1", "32.52,1,4,127612", "32.77,5,3,0,2197,0", "32.81,14,1,126705,1", "32.91,1,0,387120", "33.32,14,0,52437,1", "33.54,4,1,4,28045,0", "33.69,10,0,4,12294,0", "33.71,14,4,113092,2", "33.73,1,4,99567", "33.73,4,0,4,39888,0", "34.03,10,1,4,116,0", "34.09,5,0,4,14875,0", "34.12,1,4,44804", "34.12,13,0,60503,1,12", "34.21,9,1,4,44614,2603,1.419", "34.21,10,1,4,44614,0", "34.21,14,1,57761,1", "34.49,14,0,12880,1", "34.53,1,4,34849", "34.53,4,0,4,9754,0", "34.77,3,0,4,20213,0", "34.81,14,0,126700,1", "34.85,8,2,1,13522,0", "34.93,1,4,25095", "35.27,10,0,4,7384,0", "35.34,17,2,95", "35.34,1,4,4882", "35.34,4,0,4,39990,1", "35.34,17,4,0", "35.34,1,4,0", "35.34,14,4,113742,1", "35.34,14,4,60424,1", "35.34,14,4,57330,1", "35.34,14,4,34936,1", "35.34,14,4,115804,2", "35.34,14,4,115767,2", "35.34,14,4,116,2", "35.34,14,4,81326,2", "35.34,14,4,86346,2", "35.47,14,0,107574,1", "35.63,14,2,100977,1", "35.78,5,3,0,2198,0", "36.15,1,0,384922", "37.14,17,1,100", "37.65,8,2,1,19317,0", "38.37,10,2,2,1126,0", "38.76,5,3,0,2198,0", "38.76,14,0,81326,2", "38.76,14,0,55095,2", "38.95,1,0,382724", "39.85,13,2,90621,1,0", "40.22,10,0,-1,6343,0", "40.42,8,2,1,19316,0", "40.42,14,1,774,1", "40.5,14,0,120032,1", "40.97,1,0,386657", "42.98,1,0,390590", "43.39,17,2,100", "43.68,14,0,12294,1", "44.98,1,0,391515", "46.13,14,0,60503,1", "47.32,13,0,60118,1,0", "48.68,14,0,126665,1", "50.91,13,1,60118,1,0", "53.12,14,2,90621,1", "55.22,17,2,89", "55.22,10,2,-1,16914,0", "55.74,14,0,32216,1", "56.94,17,1,95", "56.94,10,1,-1,10,0", "56.94,14,1,60118,1", "57.88,10,1,-1,42208,0", "58.83,10,1,-1,42208,0", "59,10,1,-1,10,0", "59.94,10,1,-1,42208,0", "60.88,10,1,-1,42208,0", "61.84,14,1,11426,1", "62.66,17,1,100", "63.5,17,2,95", "65.08,17,2,86", "65.08,10,2,-1,16914,0", "66.68,17,1,95", "66.68,10,1,-1,10,0", "67.62,10,1,-1,42208,0", "68.37,10,2,-1,768,0", "68.37,10,2,-1,5215,0", "68.37,13,2,5215,1,0", "68.37,13,2,768,1,0", "68.38,17,2,100", "68.58,10,1,-1,42208,0", "68.65,10,1,-1,10,0", "69.6,10,1,-1,42208,0", "69.88,10,2,-1,77764,0", "69.88,13,2,77764,1,8", "70.51,10,1,-1,10,0", "71.47,10,1,-1,42208,0", "72.42,10,1,-1,42208,0", "72.7,17,1,90", "72.7,10,1,-1,10,0", "73.65,10,1,-1,42208,0", "74.61,10,1,-1,42208,0", "75.55,10,1,-1,42208,0", "75.57,17,1,95", "76.5,10,1,-1,42208,0", "77.17,10,1,-1,10,0", "77.88,14,2,77764,1", "78.13,10,1,-1,42208,0", "79.07,10,1,-1,42208,0", "80.02,10,1,-1,42208,0", "80.26,10,1,-1,10,0", "81.21,10,1,-1,42208,0", "82.07,10,1,-1,10,0", "83.02,10,1,-1,42208,0", "83.97,10,1,-1,42208,0", "84.34,17,1,90", "84.34,10,1,-1,10,0", "85.29,10,1,-1,42208,0", "86.24,10,1,-1,42208,0", "87.18,10,1,-1,42208,0", "88.12,10,1,-1,10,0", "89.06,10,1,-1,42208,0", "90.02,10,1,-1,42208,0", "90.44,17,1,96", "90.44,13,0,6770,2,8", "93.47,10,2,-1,68992,0", "93.47,13,2,68992,1,10", "93.7,10,0,-1,18499,0", "93.7,13,0,18499,1,6", "93.7,13,0,12880,1,6", "93.7,14,0,60118,1", "93.7,14,0,6770,2", "96.27,10,1,-1,10,0", "97.21,10,1,-1,42208,0", "98.16,10,1,-1,42208,0", "98.24,10,0,-1,52174,0", "98.24,13,0,133278,1,3", "99.1,10,1,-1,42208,0", "99.7,14,0,12880,1", "99.7,14,0,18499,1", "100.05,10,1,-1,42208,0", "101,10,1,-1,42208,0", "101.25,14,0,133278,1", "101.32,13,0,34709,2,15.002", "103.48,14,2,68992,1", "104.7,10,0,-1,86346,0", "105.34,13,0,120032,1,12", "106.55,1,3,461291", "106.55,1,4,417927", "106.55,17,4,100", "106.95,13,4,55610,1,0", "107.77,18,4,2", "108.42,14,0,1459,1"], "combatans": {"dudes": {"0x03800000043A7BDC": {"ddone": 39996, "name": "Bloodtalker", "hcrit": 7668, "hp": 461291, "hpmax": 461291, "spec": "", "hdone": 121089, "player": 1, "race": "NightElf", "team": 2, "ID": 3, "mana": 100, "starthpmax": 461291, "class": "DEATHKNIGHT"}, "0xF140D552C2000002": {"ddone": 0, "name": "Kelirylin", "hpmax": 0, "starthpmax": 208964, "hp": 0, "mana": 100, "spec": "", "hcrit": 0, "team": 2, "ID": -5, "class": "ROGUE", "hdone": 0}, "0x0380000000985677": {"ddone": 389621, "name": "Ogniana", "hcrit": 84645, "hp": 0, "hpmax": 0, "spec": "", "hdone": 0, "player": 1, "race": "Human", "team": 1, "ID": 1, "mana": 96, "starthpmax": 389975, "class": "MAGE"}, "0x0380000003AF6D07": {"ddone": 0, "name": "Oakeye", "hcrit": 0, "hp": 0, "hpmax": 0, "spec": "", "hdone": 27267, "player": 1, "race": "Worgen", "team": 1, "ID": 2, "mana": 100, "starthpmax": 386727, "class": "DRUID"}, "0xF140D552C2000003": {"ddone": 0, "name": "Kelirylin", "hpmax": 208964, "starthpmax": 208964, "hp": 208964, "mana": 100, "spec": "", "hcrit": 0, "team": 2, "ID": -5, "class": "ROGUE", "hdone": 0}, "0x03800000047709E5": {"ddone": 0, "name": "Nuffmei", "hpmax": 0, "hp": 0, "spec": "", "hdone": 0, "hcrit": 0, "race": "Human", "team": 2, "ID": -5, "starthpmax": 0, "class": "ROGUE"}, "0x0380000001C5AF27": {"ddone": 677374, "name": "Setaiaa", "hcrit": 109751, "hp": 391515, "hpmax": 391515, "spec": "", "hdone": 0, "player": 1, "race": "Human", "team": 1, "ID": 0, "mana": 100, "starthpmax": 391515, "class": "WARRIOR"}, "0x0380000004A3A261": {"ddone": 0, "name": "Celana", "hcrit": 0, "hp": 417927, "hpmax": 417927, "spec": "", "hdone": 0, "player": 1, "race": "Human", "team": 2, "ID": 4, "mana": 100, "starthpmax": 417927, "class": "WARLOCK"}}}}'
    json_data = JSON.parse(json_string);

	//globals
    var canvas = $("#arena-player");
    var context = canvas.get(0).getContext('2d');
    var container = $(canvas).parent();
    var frames = [];

    var CLASS_COLOR_MAP = {'WARRIOR':['#C69B6D', 1], 'PALADIN':['#F48CBA', 2], 'HUNTER':['#AAD372', 3], 'ROGUE':['#FFF468', 4], 'PRIEST':['#E3E3E3', 5], 'DEATHKNIGHT':['#C41E3A', 6], 'SHAMAN':['#0070DD', 7], 'MAGE':['#68CCEF', 8], 'WARLOCK':['#9482C9', 9], 'MONK':['#00FF96', 10], 'DRUID':['#FF7C0A', 11]};
    var FRAME_PADDING = 0.8;
    var FRAME_ASPECT = 0.286;
    var HEALTH_BAR_W_ASPECT = 0.78;
    var HEALTH_BAR_H_ASPECT = 0.45;
    var ICON_BORDER = 4;
	
    //$(window).resize(resize_canvas);

    function resize_canvas() {
        canvas.attr('width', $(container).width());
        canvas.attr('height', $(canvas).width() * 0.75);
    }
	
	function clear_canvas() {
        context.save();
        context.setTransform(1, 0, 0, 1, 0, 0);
		context.clearRect(0, 0, $(canvas).width(), $(canvas).height());
        context.restore();
	}

    function Frame(data){
        this._name = data.name;
        this._data = data;
        this._buffs = [];
        this._debuffs = [];
        this._translate = [0, 0];
        this._scale = [1, 1];
        this._parent = null;
        this._bbox = [-1, 1, -1, 1];
    }

    Frame.prototype = {
        name : function (){
            return this._name;
        },
        add_debuff : function (debuff){
            this._debuffs.push(debuff);
        },
        set_translate : function(x, y){
            this._translate[0] = x;
            this._translate[1] = y;
        },
        bbox : function(){
            return this._bbox;
        },
        set_bbox : function(xmin, xmax, ymin, ymax){
            this._bbox[0] = xmin;
            this._bbox[1] = xmax;
            this._bbox[2] = ymin;
            this._bbox[3] = ymax;
        },
        set_scale : function(scale){
            this._scale[0] = scale;
            this._scale[1] = scale;
        },
        draw : function (){
            context.save();
            context.translate(this._bbox[0], this._bbox[2]);

            // calculate offsets
            var w = (this._bbox[1] - this._bbox[0]);
            var h = (this._bbox[3] - this._bbox[2]);
            var ww = w * FRAME_PADDING;
            var hh = ww * FRAME_ASPECT;
            var offset_w = (w-ww)/2;
            var offset_h = (h-hh)/2;
            var h_bar_w = ww * HEALTH_BAR_W_ASPECT; 
            var h_bar_h = hh * HEALTH_BAR_H_ASPECT;
            var icon = ww - (h_bar_w + ICON_BORDER);
            var icon_image = new Image();
            icon_image.src = 'img/icons/56/class_' + CLASS_COLOR_MAP[this._data.class][1] + '.jpg';

            // draw background
            context.fillStyle = 'rgba(125, 125, 125, 0.5)';
            context.fillRect(offset_w, offset_h, ww, hh);

            // draw icon
            context.drawImage(icon_image, offset_w + ICON_BORDER/2, offset_h + ICON_BORDER/2, icon, icon);

            // draw health
            context.fillStyle = CLASS_COLOR_MAP[this._data.class][0];
            context.fillRect(offset_w + ICON_BORDER + icon, offset_h, h_bar_w, h_bar_h);

            // init font
            var font_h = Math.round(h_bar_h * 0.5);
            var font_half = font_h/2;
            context.font = font_h + "px Arial";
            context.textAlign = 'left';
            context.textBaseline = 'hanging';
            context.fillStyle = 'white';
            context.shadowColor = '#000';
            context.shadowOffsetX = context.measureText(this._name).width * 0.02;
            context.shadowOffsetY = 0;

            // draw name
            context.fillText(this._name, offset_w + ICON_BORDER + icon + font_half, offset_h + font_half);

            context.restore();
        }
    }

    function display() {
		clear_canvas();
        for (var i = 0; i < frames.length; i++)
        {
            frames[i].draw();
        }
    }
	
	//window.requestAnimationFrame
	window.requestAnimationFrame = (function(){
    return  window.requestAnimationFrame       ||  //Chromium 
            window.webkitRequestAnimationFrame ||  //Webkit
            window.mozRequestAnimationFrame    || //Mozilla Geko
            window.oRequestAnimationFrame      || //Opera Presto
            window.msRequestAnimationFrame     || //IE Trident?
            function(callback, element){ //Fallback function
                window.setTimeout(callback, 1000/60);                
            }
     
	})();
	
	function init(){
		resize_canvas();
        if (json_data == null)
            return;

        $('#battle-title').text(json_data.teams['0'].name + '(' + json_data.teams['0'].mmr + ') vs ' + json_data.teams['1'].name + '(' + json_data.teams['1'].mmr + ')');
        if (json_data.combatans && json_data.combatans.dudes)
        {
            var index = 0;
            var xmin = xmax = 0;
            var ymin = ymax = 0;
            var w_step = Math.round($(canvas).width()/2);
            var h_step = Math.round($(canvas).height()/json_data.bracket);

            dudes = json_data.combatans.dudes
            for (var key in dudes)
            {
                dude = dudes[key];
                if (dude.player)
                {
                    // calculate bbox
                    xmin = dude.team == 2 ? 0 : w_step;
                    xmax = xmin + w_step;
                    if (index > 1 && index % json_data.bracket == 0)
                        ymin += h_step;
                    ymax = ymin + h_step;

                    // init each frame
                    d_frame = new Frame(dude);
                    d_frame.set_bbox(xmin, xmax, ymin, ymax);
                    frames.push(d_frame);
                    console.log(d_frame.bbox());
                }
                index++;
            }
        }
	}
	
	function animate(){
		display();
		requestAnimationFrame(animate);
	}
	
	init();
	animate();
});
